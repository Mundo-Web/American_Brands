import{R as s,r as c}from"./FilterContainer-TykbAVkI.js";import{c as T}from"./ReactAppend-GBOQKLDe.js";import{C as M}from"./CreateReactScript-Il069F1S.js";import{F as k,P as U,a as L}from"./ProductCard-XPqV46zV.js";import"./SelectAPIFormGroup-A251JnnE.js";import{a as q}from"./arrayJoin-Fk5sgFcM.js";import{a as g}from"./axios-_sX4vCAy.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-GBzf7Cls.js";import"./CreateReactScript-Hm6EbMAE.js";import"./TippyButton-w0wM3ydO.js";const W=({minPrice:u,maxPrice:m,categories:p,tags:h,attribute_values:N,id_cat:o,tag_id:x,subCatId:b,marcas:C,marcas_id:z})=>{const[F,j]=c.useState([]),[t,n]=c.useState({}),[d,R]=c.useState(0),[l,_]=c.useState(1),[S,E]=c.useState(!1),y=c.useRef(!1),f=c.useRef(null);c.useEffect(()=>{const a=document.createElement("script");return a.src="js/notify.extend.min.js",a.async=!0,document.body.appendChild(a),()=>{document.body.removeChild(a)}},[]),c.useEffect(()=>{const a=new URLSearchParams(window.location.search),e=a.get("tag"),r=a.get("marcas");e&&n(i=>({...i,"txp.tag_id":[e]})),r&&n(i=>({...i,"txp.marcas_id":[r]})),o&&n(i=>({...i,category_id:[o]}))},[o]),c.useEffect(()=>{_(1),v()},[t]),c.useEffect(()=>{v()},[l]),c.useEffect(()=>{b!==null&&n({...t,subcategory_id:[b]})},[]);const v=async()=>{f.current&&f.current.cancel("Operation canceled due to new request."),f.current=g.CancelToken.source();const a=[];if((t.maxPrice||t.minPrice)&&(t.maxPrice&&t.minPrice?a.push([[["precio",">=",t.minPrice],"or",[["descuento",">=",t.minPrice],"and",["descuento","<>",0]]],"and",[["precio","<=",t.maxPrice],"or",[["descuento","<=",t.maxPrice],"and",["descuento","<>",0]]]]):t.minPrice?a.push([["precio",">=",t.minPrice],"or",[["descuento",">=",t.minPrice],"and",["descuento","<>",0]]]):t.maxPrice&&a.push([["precio","<=",t.maxPrice],"or",[["descuento","<=",t.maxPrice],"and",["descuento","<>",0]]])),t["txp.tag_id"]&&t["txp.tag_id"].length>0){const e=[];t["txp.tag_id"].forEach((r,i)=>{i===0?e.push(["txp.tag_id","=",r]):e.push("or",["txp.tag_id","=",r])}),a.push(e)}for(const e in t){if(!e.startsWith("attribute-")||t[e].length===0)continue;const[,r]=e.split("-"),i=[];t[e].forEach((P,O)=>{O===0?i.push(["apv.attribute_value_id","=",P]):i.push("or",["apv.attribute_value_id","=",P])}),a.push([["a.id","=",r],"and",i])}if(t.category_id&&t.category_id.length>0){const e=[];t.category_id.forEach((r,i)=>{i===0?e.push(["categoria_id","=",r]):e.push("or",["categoria_id","=",r])}),a.push(e)}if(t.marcas_id&&t.marcas_id.length>0){const e=[];t.marcas_id.forEach((r,i)=>{i===0?e.push(["marcas_id","=",r]):e.push("or",["marcas_id","=",r])}),a.push(e)}if(t.subcategory_id&&t.subcategory_id.length>0){const e=[];t.subcategory_id.forEach((r,i)=>{i===0?e.push(["subcategory_id","=",r]):e.push("or",["subcategory_id","=",r])}),a.push(e)}try{const{status:e,data:r}=await g.post("/api/products/paginate",{requireTotalCount:!0,filter:q([...a,["products.visible","=",!0]],"and"),take:12,skip:12*(l-1)},{headers:{"Content-Type":"application/json"},cancelToken:f.current.token});y.current=(r==null?void 0:r.is_proveedor)??!1,j((r==null?void 0:r.data)??[]),R((r==null?void 0:r.totalCount)??0)}catch(e){g.isCancel(e)?console.log("Request canceled",e.message):console.error(e)}},w=N.reduce((a,e)=>(a[e.attribute_id]||(a[e.attribute_id]=[]),a[e.attribute_id].push(e),a),{});return p.find(a=>a.id===Number(o)),s.createElement(s.Fragment,null,s.createElement("div",null,s.createElement("form",{className:"flex flex-col lg:flex-row gap-6  mx-auto font-Helvetica_Light font-bold w-full p-5 lg:p-10"},s.createElement("section",{className:"hidden lg:flex md:flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg h-max top-2"},s.createElement(k,{setFilter:n,filter:t,minPrice:u??0,maxPrice:m??0,categories:p,tags:h,marcas:C,attribute_values:Object.values(w),selected_category:o,tag_id:x})),s.createElement("section",{className:"flex flex-col gap-6 md:basis-9/12"},s.createElement("div",{className:"w-full bg-white rounded-lg font-medium flex flex-row justify-between items-center px-2 py-3"},s.createElement("div",{className:"flex flex-col xl:flex-row  justify-start xl:justify-between items-start gap-2 "},s.createElement("span",{className:"font-normal text-[17px] text-[#666666] xl:ml-3"},"Mostrando ",(l-1)*12+1," - ",l*12>d?d:l*12," de ",d," resultados"),s.createElement("button",{type:"button",className:"lg:hidden text-black",onClick:()=>E(!0)}," Mostrar Filtros"))),s.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 gap-4 md:pr-4"},F.map((a,e)=>s.createElement(U,{key:`product-${a.id}`,item:a,bgcolor:"bg-white",is_reseller:y.current}))),s.createElement("div",{className:"w-full font-medium flex flex-row justify-center items-center"},s.createElement(L,{current:l,setCurrent:_,pages:Math.ceil(d/12)}))),S&&s.createElement("div",{className:"fixed z-40 top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center max-h-[80vh] p-5",id:"modal"},s.createElement("div",{className:"z-50 flex items-center content-center justify-center absolute  p-4 bg-black rounded-full h-6 w-6",style:{top:"20px",right:"20px"}},s.createElement("button",{type:"button",onClick:()=>E(!1),className:"text-white text-md "},"X")),s.createElement("div",{className:"flex flex-col gap-4 w-full bg-white p-6 rounded-lg top-2 overflow-y-auto mt-10",style:{maxHeight:"90vh",maxWidth:"85vh"}},s.createElement(k,{setFilter:n,filter:t,minPrice:u??0,maxPrice:m??0,categories:p,tags:h,attribute_values:Object.values(w),selected_category:o,tag_id:x})))),s.createElement("section",{className:"w-full px-[5%] relative mx-auto pt-12 lg:pt-16"},s.createElement("h2",{className:"text-center font-Urbanist_Black text-2xl lg:text-3xl text-black"},"FOLLOW US ",s.createElement("span",{class:"font-Urbanist_Regular"}," ON "),s.createElement("span",{className:"font-Urbanist_Regular italic"}," @americanbrandspe ")))))};M((u,m)=>{T(u).render(s.createElement(W,{...m}))});
