import{R as t,r as s}from"./FilterContainer-TykbAVkI.js";import{c as T}from"./ReactAppend-GBOQKLDe.js";import{C as z}from"./CreateReactScript-Il069F1S.js";import{F as k,P as A,a as B}from"./ProductCard-qq8-hW91.js";import"./SelectAPIFormGroup-A251JnnE.js";import{a as O}from"./arrayJoin-Fk5sgFcM.js";import{a as W}from"./axios-_sX4vCAy.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-GBzf7Cls.js";import"./CreateReactScript-Hm6EbMAE.js";import"./TippyButton-w0wM3ydO.js";const q=({minPrice:u,maxPrice:m,categories:x,tags:b,attribute_values:F,id_cat:d,tag_id:f,subCatId:y})=>{s.useEffect(()=>{const r=document.createElement("script");return r.src="js/notify.extend.min.js",r.async=!0,document.body.appendChild(r),()=>{document.body.removeChild(r)}},[null]);const[N,j]=s.useState([]),[e,g]=s.useState(d?{category_id:[d]}:{"txp.tag_id":[f]}),[p,S]=s.useState(0),[n,E]=s.useState(1),[M,_]=s.useState(!1),v=s.useRef(!1);s.useEffect(()=>{y!==null&&g({...e,subcategory_id:[y]})},[]),s.useEffect(()=>{E(1),w()},[e]),s.useEffect(()=>{w()},[n]);let h=new AbortController;const w=async()=>{h.abort("some"),h=new AbortController;let r=h.signal;const i=[];if((e.maxPrice||e.minPrice)&&(e.maxPrice&&e.minPrice?i.push([[["precio",">=",e.minPrice],"or",["descuento",">=",e.minPrice]],"and",[["precio","<=",e.maxPrice],"or",["descuento","<=",e.maxPrice]]]):e.minPrice?i.push([["precio",">=",e.minPrice],"or",["descuento",">=",e.minPrice]]):e.maxPrice&&i.push([["precio","<=",e.maxPrice],"or",["descuento","<=",e.maxPrice]])),e["txp.tag_id"]&&e["txp.tag_id"].length>0){const a=[];e["txp.tag_id"].forEach((o,c)=>{c==0?a.push(["txp.tag_id","=",o]):a.push("or",["txp.tag_id","=",o])}),i.push(a)}for(const a in e){if(!a.startsWith("attribute-")||e[a].length==0)continue;const[,o]=a.split("-"),c=[];e[a].forEach((C,R)=>{R==0?c.push(["apv.attribute_value_id","=",C]):c.push("or",["apv.attribute_value_id","=",C])}),i.push([["a.id","=",o],"and",c])}if(e.category_id&&e.category_id.length>0){const a=[];e.category_id.forEach((o,c)=>{c==0?a.push(["categoria_id","=",o]):a.push("or",["categoria_id","=",o])}),i.push(a)}if(e.subcategory_id&&e.subcategory_id.length>0){const a=[];e.subcategory_id.forEach((o,c)=>{c==0?a.push(["subcategory_id","=",o]):a.push("or",["subcategory_id","=",o])}),i.push(a)}const{status:I,data:l}=await W.post("/api/products/paginate",{requireTotalCount:!0,filter:O([...i,["products.visible","=",!0]],"and"),take:12,skip:12*(n-1)},{headers:{"Content-Type":"application/json"},signal:r});v.current=(l==null?void 0:l.is_proveedor)??!1,j((l==null?void 0:l.data)??[]),S((l==null?void 0:l.totalCount)??0)},P=F.reduce((r,i)=>(r[i.attribute_id]||(r[i.attribute_id]=[]),r[i.attribute_id].push(i),r),{});return t.createElement(t.Fragment,null,t.createElement("style",null),t.createElement("form",{className:"flex flex-col md:flex-row gap-6  mx-auto font-poppins bg-[#F1F1F1] w-full",style:{padding:"40px"}},t.createElement("section",{className:"hidden md:flex md:flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg h-max md:sticky top-2"},t.createElement(k,{setFilter:g,filter:e,minPrice:u??0,maxPrice:m??0,categories:x,tags:b,attribute_values:Object.values(P),selected_category:d,tag_id:f})),t.createElement("section",{className:"flex flex-col gap-6 md:basis-9/12"},t.createElement("div",{className:"w-full bg-white rounded-lg font-medium flex flex-row justify-between items-center px-2 py-3"},t.createElement("div",{className:"flex flex-row gap-2"},t.createElement("span",{className:"font-normal text-[17px] text-[#666666] ml-3"},"Mostrando ",(n-1)*12+1," - ",n*12>p?p:n*12," de ",p," resultados"),t.createElement("button",{type:"button",className:"md:hidden text-[#006BF6]",onClick:()=>_(!0)}," Mostrar Filtros"))),t.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:pr-4"},N.map((r,i)=>t.createElement(A,{key:`product-${r.id}`,item:r,bgcolor:"bg-white",is_reseller:v.current}))),t.createElement("div",{className:"w-full font-medium flex flex-row justify-center items-center"},t.createElement(B,{current:n,setCurrent:E,pages:Math.ceil(p/12)}))),M&&t.createElement("div",{className:"fixed z-40 top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center max-h-[80vh] ",id:"modal"},t.createElement("div",{className:"z-50 flex items-center content-center justify-center absolute  p-4 bg-black rounded-full h-6 w-6",style:{top:"20px",right:"20px"}},t.createElement("button",{type:"button",onClick:()=>_(!1),className:"text-white text-md "},"X")),t.createElement("div",{className:"flex flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg top-2 overflow-y-auto mt-10",style:{maxHeight:"90vh",maxWidth:"85vh"}},t.createElement(k,{setFilter:g,filter:e,minPrice:u??0,maxPrice:m??0,categories:x,tags:b,attribute_values:Object.values(P),selected_category:d,tag_id:f})))))};z((u,m)=>{T(u).render(t.createElement(q,{...m}))});
